<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š æ¯”èµ›æ•°æ®åˆ†æ - è‹±é›„è”ç›Ÿæ•°æ®åˆ†æä¸­å¿ƒ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="/" class="logo">
                <i class="fas fa-crown"></i>
                <span>LOLæ•°æ®åˆ†æä¸­å¿ƒ</span>
            </a>
            <ul class="nav-links">
                <li><a href="/"><i class="fas fa-home"></i> é¦–é¡µ</a></li>
                <li><a href="/items"><i class="fas fa-helmet-battle"></i> è£…å¤‡æ•°æ®</a></li>
                <li><a href="/match_analysis" class="active"><i class="fas fa-chart-line"></i> æ¯”èµ›åˆ†æ</a></li>
                <li><a href="/upload_match"><i class="fas fa-upload"></i> ä¸Šä¼ æ¯”èµ›</a></li>
                <li><a href="/about"><i class="fas fa-info-circle"></i> å…³äº</a></li>
            </ul>
        </div>
    </nav>

    <!-- è‹±é›„åŒºåŸŸ -->
    <section class="hero">
        <h1><i class="fas fa-chart-line"></i> æ¯”èµ›æ•°æ®åˆ†æ</h1>
        <p>æ·±åº¦æŒ–æ˜æ¯”èµ›æ•°æ®ï¼Œæ´å¯Ÿèƒœåˆ©æ¨¡å¼ï¼Œä¼˜åŒ–æˆ˜æœ¯ç­–ç•¥</p>
    </section>

    <!-- æ•°æ®æ¦‚è§ˆ -->
    <div class="card-grid">
        <div class="card">
            <h3><i class="fas fa-trophy"></i> æ¯”èµ›æ€»æ•°</h3>
            <p style="font-size: 2.5rem; font-weight: bold; color: var(--lol-gold);">{{ total_matches }}</p>
            <p>å·²åˆ†æçš„æœ‰æ•ˆæ¯”èµ›åœºæ¬¡</p>
        </div>
        
        <div class="card">
            <h3><i class="fas fa-clock"></i> å¹³å‡æ—¶é•¿</h3>
            <p style="font-size: 2.5rem; font-weight: bold; color: var(--lol-blue);">{{ avg_duration // 60 }}åˆ†é’Ÿ</p>
            <p>å¹³å‡æ¯åœºæ¯”èµ›æ—¶é•¿</p>
        </div>
        
        <div class="card">
            <h3><i class="fas fa-flag"></i> è“é˜Ÿèƒœç‡</h3>
            <p style="font-size: 2.5rem; font-weight: bold; color: #4A90E2;">
                {% if total_matches > 0 %}
                    {{ (blue_wins * 100 / total_matches)|round(1) }}%
                {% else %}0%{% endif %}
            </p>
            <p>è“è‰²æ–¹è·èƒœæ¯”ä¾‹</p>
        </div>
        
        <div class="card">
            <h3><i class="fas fa-flag"></i> çº¢é˜Ÿèƒœç‡</h3>
            <p style="font-size: 2.5rem; font-weight: bold; color: #E24A4A;">
                {% if total_matches > 0 %}
                    {{ (red_wins * 100 / total_matches)|round(1) }}%
                {% else %}0%{% endif %}
            </p>
            <p>çº¢è‰²æ–¹è·èƒœæ¯”ä¾‹</p>
        </div>
    </div>

    <!-- åˆ†æé¢æ¿ -->
    <div style="max-width: 1200px; margin: 2rem auto; padding: 0 1rem;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
            <!-- èƒœç‡åˆ†æ -->
            <div class="card">
                <h3><i class="fas fa-chart-pie"></i> æ¸¸æˆæ—¶é•¿ä¸èƒœç‡</h3>
                <div style="height: 300px;">
                    <canvas id="durationWinRateChart"></canvas>
                </div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 1rem;">
                    åˆ†æä¸åŒæ—¶é•¿æ¯”èµ›çš„èƒœç‡åˆ†å¸ƒ
                </p>
            </div>
            
            <!-- è‹±é›„æ•°æ® -->
            <div class="card">
                <h3><i class="fas fa-user"></i> çƒ­é—¨è‹±é›„ç»Ÿè®¡</h3>
                <div style="height: 300px;">
                    <canvas id="popularChampionsChart"></canvas>
                </div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 1rem;">
                    å‡ºåœºç‡æœ€é«˜çš„10ä½è‹±é›„
                </p>
            </div>
        </div>

        <!-- è‹±é›„è¯¦ç»†æ•°æ® -->
        <div class="card" style="margin-bottom: 2rem;">
            <h3><i class="fas fa-search"></i> è‹±é›„æ•°æ®æŸ¥è¯¢</h3>
            <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                <input type="text" id="championSearch" placeholder="è¾“å…¥è‹±é›„åç§°ï¼ˆå¦‚ï¼šZed, Yasuoï¼‰" 
                       style="flex: 1; padding: 0.8rem; background: rgba(30, 35, 40, 0.8); 
                              border: 2px solid var(--lol-gold); border-radius: 6px; color: var(--text-primary);">
                <button onclick="loadChampionStats()" class="btn">
                    <i class="fas fa-search"></i> æŸ¥è¯¢
                </button>
                <button onclick="loadAllChampions()" class="btn btn-secondary">
                    <i class="fas fa-list"></i> æŸ¥çœ‹å…¨éƒ¨
                </button>
            </div>
            
            <div id="championStatsContainer">
                <table style="width: 100%; border-collapse: collapse; color: var(--text-primary);">
                    <thead>
                        <tr style="background: rgba(200, 170, 110, 0.1);">
                            <th style="padding: 1rem; text-align: left;">è‹±é›„</th>
                            <th style="padding: 1rem; text-align: center;">å‡ºåœºæ¬¡æ•°</th>
                            <th style="padding: 1rem; text-align: center;">å¹³å‡KDA</th>
                            <th style="padding: 1rem; text-align: center;">èƒœç‡</th>
                            <th style="padding: 1rem; text-align: center;">å¹³å‡é‡‘å¸</th>
                            <th style="padding: 1rem; text-align: center;">è¯¦ç»†</th>
                        </tr>
                    </thead>
                    <tbody id="championStatsBody">
                        <!-- æ•°æ®ç”±JavaScriptåŠ¨æ€åŠ è½½ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- æœ€è¿‘æ¯”èµ› -->
        <div class="card">
            <h3><i class="fas fa-history"></i> æœ€è¿‘æ¯”èµ›</h3>
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; color: var(--text-primary);">
                    <thead>
                        <tr style="background: rgba(200, 170, 110, 0.1);">
                            <th style="padding: 1rem; text-align: left;">æ¯”èµ›ID</th>
                            <th style="padding: 1rem; text-align: center;">ç‰ˆæœ¬</th>
                            <th style="padding: 1rem; text-align: center;">æ—¶é•¿</th>
                            <th style="padding: 1rem; text-align: center;">æ¯”åˆ†</th>
                            <th style="padding: 1rem; text-align: center;">èƒœè´Ÿ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for match in recent_matches %}
                        <tr style="border-bottom: 1px solid rgba(200, 170, 110, 0.1);">
                            <td style="padding: 1rem;">{{ match[0][:15] }}...</td>
                            <td style="padding: 1rem; text-align: center;">{{ match[1] }}</td>
                            <td style="padding: 1rem; text-align: center;">{{ match[2] // 60 }}åˆ†é’Ÿ</td>
                            <td style="padding: 1rem; text-align: center;">
                                <span style="color: #4A90E2;">{{ match[4] }}</span> - 
                                <span style="color: #E24A4A;">{{ match[5] }}</span>
                            </td>
                            <td style="padding: 1rem; text-align: center;">
                                {% if match[3] == 1 %}
                                <span style="color: #4A90E2; font-weight: bold;">è“é˜Ÿèƒœ</span>
                                {% else %}
                                <span style="color: #E24A4A; font-weight: bold;">çº¢é˜Ÿèƒœ</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- é˜µå®¹åˆ†æ -->
        <div class="card" style="margin-top: 2rem;">
            <h3><i class="fas fa-users"></i> çƒ­é—¨é˜µå®¹åˆ†æ</h3>
            <div style="height: 400px;">
                <canvas id="teamCompositionChart"></canvas>
            </div>
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 1rem;">
                æœ€å¸¸è§çš„é˜µå®¹ç»„åˆåŠå…¶èƒœç‡
            </p>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>æ¯”èµ›åˆ†æåŠŸèƒ½</h4>
                <p style="color: var(--text-secondary); margin-top: 1rem;">
                    æä¾›æ·±åº¦æ¯”èµ›æ•°æ®åˆ†æï¼ŒåŒ…æ‹¬èƒœç‡ç»Ÿè®¡ã€è‹±é›„è¡¨ç°ã€é˜µå®¹ç»„åˆç­‰ã€‚
                </p>
            </div>
            
            <div class="footer-section">
                <h4>æ•°æ®æ¥æº</h4>
                <ul class="footer-links">
                    <li><a href="/upload_match">ä¸Šä¼ æ¯”èµ›æ•°æ®</a></li>
                    <li><a href="#">Riot Games API</a></li>
                    <li><a href="#">ç¤¾åŒºè´¡çŒ®</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h4>åˆ†æå·¥å…·</h4>
                <ul class="footer-links">
                    <li><a href="#" onclick="loadWinRateAnalysis()">èƒœç‡åˆ†æ</a></li>
                    <li><a href="#" onclick="loadAllChampions()">è‹±é›„ç»Ÿè®¡</a></li>
                    <li><a href="#" onclick="loadTeamComposition()">é˜µå®¹åˆ†æ</a></li>
                </ul>
            </div>
        </div>
    </footer>

    <script>
        // åˆå§‹åŒ–å›¾è¡¨
        let durationChart, championsChart, compositionChart;
        
        // åŠ è½½èƒœç‡åˆ†æ
        async function loadWinRateAnalysis() {
            try {
                const response = await fetch('/api/analysis/win_rate');
                const data = await response.json();
                
                if (data.success && data.data.length > 0) {
                    const ctx = document.getElementById('durationWinRateChart').getContext('2d');
                    
                    if (durationChart) durationChart.destroy();
                    
                    durationChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: data.data.map(d => d.duration_range),
                            datasets: [{
                                label: 'è“é˜Ÿèƒœç‡',
                                data: data.data.map(d => d.blue_win_rate),
                                backgroundColor: 'rgba(74, 144, 226, 0.7)',
                                borderColor: 'rgba(74, 144, 226, 1)',
                                borderWidth: 1
                            }, {
                                label: 'çº¢é˜Ÿèƒœç‡',
                                data: data.data.map(d => d.red_win_rate),
                                backgroundColor: 'rgba(226, 74, 74, 0.7)',
                                borderColor: 'rgba(226, 74, 74, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    title: {
                                        display: true,
                                        text: 'èƒœç‡ (%)'
                                    }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('åŠ è½½èƒœç‡åˆ†æå¤±è´¥:', error);
            }
        }
        
        // åŠ è½½è‹±é›„æ•°æ®
        async function loadChampionStats(champion = '') {
            try {
                let url = '/api/analysis/champion_stats';
                if (champion) {
                    url += `?champion=${encodeURIComponent(champion)}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    updateChampionTable(data.data);
                    
                    // å¦‚æœæ˜¯æŸ¥è¯¢æ‰€æœ‰è‹±é›„ï¼Œä¹Ÿæ›´æ–°å›¾è¡¨
                    if (!champion) {
                        updatePopularChampionsChart(data.data.slice(0, 10));
                    }
                }
            } catch (error) {
                console.error('åŠ è½½è‹±é›„æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½æ‰€æœ‰è‹±é›„
        async function loadAllChampions() {
            document.getElementById('championSearch').value = '';
            await loadChampionStats();
        }
        
        // æ›´æ–°è‹±é›„è¡¨æ ¼
        function updateChampionTable(champions) {
            const tbody = document.getElementById('championStatsBody');
            tbody.innerHTML = '';
            
            champions.forEach(champ => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid rgba(200, 170, 110, 0.1)';
                
                row.innerHTML = `
                    <td style="padding: 1rem;">
                        <strong style="color: var(--lol-gold);">${champ.champion}</strong>
                    </td>
                    <td style="padding: 1rem; text-align: center;">${champ.games}</td>
                    <td style="padding: 1rem; text-align: center;">
                        <span style="color: ${champ.kda >= 3 ? '#4CAF50' : '#FF9800'}; font-weight: bold;">
                            ${champ.kda}
                        </span>
                    </td>
                    <td style="padding: 1rem; text-align: center;">
                        <span style="color: ${champ.win_rate >= 50 ? '#4CAF50' : '#E24A4A'}; font-weight: bold;">
                            ${champ.win_rate}%
                        </span>
                    </td>
                    <td style="padding: 1rem; text-align: center;">
                        ${champ.gold.toLocaleString()}
                    </td>
                    <td style="padding: 1rem; text-align: center;">
                        <button onclick="showChampionDetail('${champ.champion}')" class="btn" style="padding: 0.3rem 0.8rem; font-size: 0.9rem;">
                            è¯¦æƒ…
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // æ›´æ–°çƒ­é—¨è‹±é›„å›¾è¡¨
        function updatePopularChampionsChart(champions) {
            const ctx = document.getElementById('popularChampionsChart').getContext('2d');
            
            if (championsChart) championsChart.destroy();
            
            championsChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: champions.map(c => c.champion),
                    datasets: [{
                        data: champions.map(c => c.games),
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', 
                            '#9966FF', '#FF9F40', '#8AC926', '#1982C4',
                            '#6A4C93', '#FF595E'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: 'var(--text-primary)'
                            }
                        }
                    }
                }
            });
        }
        
        // åŠ è½½é˜µå®¹åˆ†æ
        async function loadTeamComposition() {
            try {
                const response = await fetch('/api/analysis/team_composition');
                const data = await response.json();
                
                if (data.success) {
                    const ctx = document.getElementById('teamCompositionChart').getContext('2d');
                    
                    if (compositionChart) compositionChart.destroy();
                    
                    compositionChart = new Chart(ctx, {
                        type: 'horizontalBar',
                        data: {
                            labels: data.data.map(d => d.composition.split(',').slice(0, 3).join(',') + '...'),
                            datasets: [{
                                label: 'èƒœç‡ (%)',
                                data: data.data.map(d => d.win_rate),
                                backgroundColor: data.data.map(d => 
                                    d.win_rate >= 50 ? 'rgba(76, 175, 80, 0.7)' : 'rgba(226, 74, 74, 0.7)'
                                ),
                                borderColor: data.data.map(d => 
                                    d.win_rate >= 50 ? 'rgba(76, 175, 80, 1)' : 'rgba(226, 74, 74, 1)'
                                ),
                                borderWidth: 1
                            }]
                        },
                        options: {
                            indexAxis: 'y',
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    beginAtZero: true,
                                    max: 100,
                                    title: {
                                        display: true,
                                        text: 'èƒœç‡ (%)'
                                    }
                                }
                            },
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const data = context.dataset.data[context.dataIndex];
                                            const comp = data.context.composition;
                                            const freq = data.context.frequency;
                                            return `é˜µå®¹: ${comp}\nå‡ºåœº: ${freq}æ¬¡\nèƒœç‡: ${data}%`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                    
                    // ä¸ºå›¾è¡¨æ•°æ®æ·»åŠ ä¸Šä¸‹æ–‡
                    compositionChart.data.datasets[0].data = compositionChart.data.datasets[0].data.map((value, index) => ({
                        value: value,
                        context: data.data[index]
                    }));
                }
            } catch (error) {
                console.error('åŠ è½½é˜µå®¹åˆ†æå¤±è´¥:', error);
            }
        }
        
        // è‹±é›„è¯¦æƒ…å¼¹çª—
        function showChampionDetail(champion) {
            alert(`å³å°†æ˜¾ç¤º ${champion} çš„è¯¦ç»†åˆ†æ...\n\næ­¤åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼`);
        }
        
        // æœç´¢è‹±é›„
        document.getElementById('championSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const champion = this.value.trim();
                if (champion) {
                    loadChampionStats(champion);
                }
            }
        });
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadWinRateAnalysis();
            loadChampionStats();
            loadTeamComposition();
        });
    </script>
    
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(200, 170, 110, 0.1);
        }
        
        th {
            background-color: rgba(200, 170, 110, 0.1);
            font-weight: 600;
            color: var(--lol-gold);
        }
        
        tr:hover {
            background-color: rgba(200, 170, 110, 0.05);
        }
        
        .chart-container {
            position: relative;
            height: 300px;




cd /home/mouxu/project

# åˆ›å»ºmatch_analysis.html
cat > templates/match_analysis.html << 'EOF'
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“Š æ¯”èµ›æ•°æ®åˆ†æ - è‹±é›„è”ç›Ÿæ•°æ®åˆ†æä¸­å¿ƒ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="/" class="logo">
                <i class="fas fa-crown"></i>
                <span>LOLæ•°æ®åˆ†æä¸­å¿ƒ</span>
            </a>
            <ul class="nav-links">
                <li><a href="/"><i class="fas fa-home"></i> é¦–é¡µ</a></li>
                <li><a href="/items"><i class="fas fa-helmet-battle"></i> è£…å¤‡æ•°æ®</a></li>
                <li><a href="/match_analysis" class="active"><i class="fas fa-chart-line"></i> æ¯”èµ›åˆ†æ</a></li>
                <li><a href="/upload_match"><i class="fas fa-upload"></i> ä¸Šä¼ æ¯”èµ›</a></li>
                <li><a href="/about"><i class="fas fa-info-circle"></i> å…³äº</a></li>
            </ul>
        </div>
    </nav>

    <!-- è‹±é›„åŒºåŸŸ -->
    <section class="hero">
        <h1><i class="fas fa-chart-line"></i> æ¯”èµ›æ•°æ®åˆ†æ</h1>
        <p>æ·±åº¦æŒ–æ˜æ¯”èµ›æ•°æ®ï¼Œæ´å¯Ÿèƒœåˆ©æ¨¡å¼ï¼Œä¼˜åŒ–æˆ˜æœ¯ç­–ç•¥</p>
    </section>

    <!-- æ•°æ®æ¦‚è§ˆ -->
    <div class="card-grid">
        <div class="card">
            <h3><i class="fas fa-trophy"></i> æ¯”èµ›æ€»æ•°</h3>
            <p style="font-size: 2.5rem; font-weight: bold; color: var(--lol-gold);">{{ total_matches }}</p>
            <p>å·²åˆ†æçš„æœ‰æ•ˆæ¯”èµ›åœºæ¬¡</p>
        </div>
        
        <div class="card">
            <h3><i class="fas fa-clock"></i> å¹³å‡æ—¶é•¿</h3>
            <p style="font-size: 2.5rem; font-weight: bold; color: var(--lol-blue);">{{ avg_duration // 60 }}åˆ†é’Ÿ</p>
            <p>å¹³å‡æ¯åœºæ¯”èµ›æ—¶é•¿</p>
        </div>
        
        <div class="card">
            <h3><i class="fas fa-flag"></i> è“é˜Ÿèƒœç‡</h3>
            <p style="font-size: 2.5rem; font-weight: bold; color: #4A90E2;">
                {% if total_matches > 0 %}
                    {{ (blue_wins * 100 / total_matches)|round(1) }}%
                {% else %}0%{% endif %}
            </p>
            <p>è“è‰²æ–¹è·èƒœæ¯”ä¾‹</p>
        </div>
        
        <div class="card">
            <h3><i class="fas fa-flag"></i> çº¢é˜Ÿèƒœç‡</h3>
            <p style="font-size: 2.5rem; font-weight: bold; color: #E24A4A;">
                {% if total_matches > 0 %}
                    {{ (red_wins * 100 / total_matches)|round(1) }}%
                {% else %}0%{% endif %}
            </p>
            <p>çº¢è‰²æ–¹è·èƒœæ¯”ä¾‹</p>
        </div>
    </div>

    <!-- åˆ†æé¢æ¿ -->
    <div style="max-width: 1200px; margin: 2rem auto; padding: 0 1rem;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
            <!-- èƒœç‡åˆ†æ -->
            <div class="card">
                <h3><i class="fas fa-chart-pie"></i> æ¸¸æˆæ—¶é•¿ä¸èƒœç‡</h3>
                <div style="height: 300px;">
                    <canvas id="durationWinRateChart"></canvas>
                </div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 1rem;">
                    åˆ†æä¸åŒæ—¶é•¿æ¯”èµ›çš„èƒœç‡åˆ†å¸ƒ
                </p>
            </div>
            
            <!-- è‹±é›„æ•°æ® -->
            <div class="card">
                <h3><i class="fas fa-user"></i> çƒ­é—¨è‹±é›„ç»Ÿè®¡</h3>
                <div style="height: 300px;">
                    <canvas id="popularChampionsChart"></canvas>
                </div>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 1rem;">
                    å‡ºåœºç‡æœ€é«˜çš„10ä½è‹±é›„
                </p>
            </div>
        </div>

        <!-- è‹±é›„è¯¦ç»†æ•°æ® -->
        <div class="card" style="margin-bottom: 2rem;">
            <h3><i class="fas fa-search"></i> è‹±é›„æ•°æ®æŸ¥è¯¢</h3>
            <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                <input type="text" id="championSearch" placeholder="è¾“å…¥è‹±é›„åç§°ï¼ˆå¦‚ï¼šZed, Yasuoï¼‰" 
                       style="flex: 1; padding: 0.8rem; background: rgba(30, 35, 40, 0.8); 
                              border: 2px solid var(--lol-gold); border-radius: 6px; color: var(--text-primary);">
                <button onclick="loadChampionStats()" class="btn">
                    <i class="fas fa-search"></i> æŸ¥è¯¢
                </button>
                <button onclick="loadAllChampions()" class="btn btn-secondary">
                    <i class="fas fa-list"></i> æŸ¥çœ‹å…¨éƒ¨
                </button>
            </div>
            
            <div id="championStatsContainer">
                <table style="width: 100%; border-collapse: collapse; color: var(--text-primary);">
                    <thead>
                        <tr style="background: rgba(200, 170, 110, 0.1);">
                            <th style="padding: 1rem; text-align: left;">è‹±é›„</th>
                            <th style="padding: 1rem; text-align: center;">å‡ºåœºæ¬¡æ•°</th>
                            <th style="padding: 1rem; text-align: center;">å¹³å‡KDA</th>
                            <th style="padding: 1rem; text-align: center;">èƒœç‡</th>
                            <th style="padding: 1rem; text-align: center;">å¹³å‡é‡‘å¸</th>
                            <th style="padding: 1rem; text-align: center;">è¯¦ç»†</th>
                        </tr>
                    </thead>
                    <tbody id="championStatsBody">
                        <!-- æ•°æ®ç”±JavaScriptåŠ¨æ€åŠ è½½ -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- æœ€è¿‘æ¯”èµ› -->
        <div class="card">
            <h3><i class="fas fa-history"></i> æœ€è¿‘æ¯”èµ›</h3>
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; color: var(--text-primary);">
                    <thead>
                        <tr style="background: rgba(200, 170, 110, 0.1);">
                            <th style="padding: 1rem; text-align: left;">æ¯”èµ›ID</th>
                            <th style="padding: 1rem; text-align: center;">ç‰ˆæœ¬</th>
                            <th style="padding: 1rem; text-align: center;">æ—¶é•¿</th>
                            <th style="padding: 1rem; text-align: center;">æ¯”åˆ†</th>
                            <th style="padding: 1rem; text-align: center;">èƒœè´Ÿ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for match in recent_matches %}
                        <tr style="border-bottom: 1px solid rgba(200, 170, 110, 0.1);">
                            <td style="padding: 1rem;">{{ match[0][:15] }}...</td>
                            <td style="padding: 1rem; text-align: center;">{{ match[1] }}</td>
                            <td style="padding: 1rem; text-align: center;">{{ match[2] // 60 }}åˆ†é’Ÿ</td>
                            <td style="padding: 1rem; text-align: center;">
                                <span style="color: #4A90E2;">{{ match[4] }}</span> - 
                                <span style="color: #E24A4A;">{{ match[5] }}</span>
                            </td>
                            <td style="padding: 1rem; text-align: center;">
                                {% if match[3] == 1 %}
                                <span style="color: #4A90E2; font-weight: bold;">è“é˜Ÿèƒœ</span>
                                {% else %}
                                <span style="color: #E24A4A; font-weight: bold;">çº¢é˜Ÿèƒœ</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- é˜µå®¹åˆ†æ -->
        <div class="card" style="margin-top: 2rem;">
            <h3><i class="fas fa-users"></i> çƒ­é—¨é˜µå®¹åˆ†æ</h3>
            <div style="height: 400px;">
                <canvas id="teamCompositionChart"></canvas>
            </div>
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 1rem;">
                æœ€å¸¸è§çš„é˜µå®¹ç»„åˆåŠå…¶èƒœç‡
            </p>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>æ¯”èµ›åˆ†æåŠŸèƒ½</h4>
                <p style="color: var(--text-secondary); margin-top: 1rem;">
                    æä¾›æ·±åº¦æ¯”èµ›æ•°æ®åˆ†æï¼ŒåŒ…æ‹¬èƒœç‡ç»Ÿè®¡ã€è‹±é›„è¡¨ç°ã€é˜µå®¹ç»„åˆç­‰ã€‚
                </p>
            </div>
            
            <div class="footer-section">
                <h4>æ•°æ®æ¥æº</h4>
                <ul class="footer-links">
                    <li><a href="/upload_match">ä¸Šä¼ æ¯”èµ›æ•°æ®</a></li>
                    <li><a href="#">Riot Games API</a></li>
                    <li><a href="#">ç¤¾åŒºè´¡çŒ®</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h4>åˆ†æå·¥å…·</h4>
                <ul class="footer-links">
                    <li><a href="#" onclick="loadWinRateAnalysis()">èƒœç‡åˆ†æ</a></li>
                    <li><a href="#" onclick="loadAllChampions()">è‹±é›„ç»Ÿè®¡</a></li>
                    <li><a href="#" onclick="loadTeamComposition()">é˜µå®¹åˆ†æ</a></li>
                </ul>
            </div>
        </div>
    </footer>

    <script>
        // åˆå§‹åŒ–å›¾è¡¨
        let durationChart, championsChart, compositionChart;
        
        // åŠ è½½èƒœç‡åˆ†æ
        async function loadWinRateAnalysis() {
            try {
                const response = await fetch('/api/analysis/win_rate');
                const data = await response.json();
                
                if (data.success && data.data.length > 0) {
                    const ctx = document.getElementById('durationWinRateChart').getContext('2d');
                    
                    if (durationChart) durationChart.destroy();
                    
                    durationChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: data.data.map(d => d.duration_range),
                            datasets: [{
                                label: 'è“é˜Ÿèƒœç‡',
                                data: data.data.map(d => d.blue_win_rate),
                                backgroundColor: 'rgba(74, 144, 226, 0.7)',
                                borderColor: 'rgba(74, 144, 226, 1)',
                                borderWidth: 1
                            }, {
                                label: 'çº¢é˜Ÿèƒœç‡',
                                data: data.data.map(d => d.red_win_rate),
                                backgroundColor: 'rgba(226, 74, 74, 0.7)',
                                borderColor: 'rgba(226, 74, 74, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    title: {
                                        display: true,
                                        text: 'èƒœç‡ (%)'
                                    }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('åŠ è½½èƒœç‡åˆ†æå¤±è´¥:', error);
            }
        }
        
        // åŠ è½½è‹±é›„æ•°æ®
        async function loadChampionStats(champion = '') {
            try {
                let url = '/api/analysis/champion_stats';
                if (champion) {
                    url += `?champion=${encodeURIComponent(champion)}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    updateChampionTable(data.data);
                    
                    // å¦‚æœæ˜¯æŸ¥è¯¢æ‰€æœ‰è‹±é›„ï¼Œä¹Ÿæ›´æ–°å›¾è¡¨
                    if (!champion) {
                        updatePopularChampionsChart(data.data.slice(0, 10));
                    }
                }
            } catch (error) {
                console.error('åŠ è½½è‹±é›„æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½æ‰€æœ‰è‹±é›„
        async function loadAllChampions() {
            document.getElementById('championSearch').value = '';
            await loadChampionStats();
        }
        
        // æ›´æ–°è‹±é›„è¡¨æ ¼
        function updateChampionTable(champions) {
            const tbody = document.getElementById('championStatsBody');
            tbody.innerHTML = '';
            
            champions.forEach(champ => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid rgba(200, 170, 110, 0.1)';
                
                row.innerHTML = `
                    <td style="padding: 1rem;">
                        <strong style="color: var(--lol-gold);">${champ.champion}</strong>
                    </td>
                    <td style="padding: 1rem; text-align: center;">${champ.games}</td>
                    <td style="padding: 1rem; text-align: center;">
                        <span style="color: ${champ.kda >= 3 ? '#4CAF50' : '#FF9800'}; font-weight: bold;">
                            ${champ.kda}
                        </span>
                    </td>
                    <td style="padding: 1rem; text-align: center;">
                        <span style="color: ${champ.win_rate >= 50 ? '#4CAF50' : '#E24A4A'}; font-weight: bold;">
                            ${champ.win_rate}%
                        </span>
                    </td>
                    <td style="padding: 1rem; text-align: center;">
                        ${champ.gold.toLocaleString()}
                    </td>
                    <td style="padding: 1rem; text-align: center;">
                        <button onclick="showChampionDetail('${champ.champion}')" class="btn" style="padding: 0.3rem 0.8rem; font-size: 0.9rem;">
                            è¯¦æƒ…
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        // æ›´æ–°çƒ­é—¨è‹±é›„å›¾è¡¨
        function updatePopularChampionsChart(champions) {
            const ctx = document.getElementById('popularChampionsChart').getContext('2d');
            
            if (championsChart) championsChart.destroy();
            
            championsChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: champions.map(c => c.champion),
                    datasets: [{
                        data: champions.map(c => c.games),
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', 
                            '#9966FF', '#FF9F40', '#8AC926', '#1982C4',
                            '#6A4C93', '#FF595E'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: 'var(--text-primary)'
                            }
                        }
                    }
                }
            });
        }
        
        // åŠ è½½é˜µå®¹åˆ†æ
        async function loadTeamComposition() {
            try {
                const response = await fetch('/api/analysis/team_composition');
                const data = await response.json();
                
                if (data.success) {
                    const ctx = document.getElementById('teamCompositionChart').getContext('2d');
                    
                    if (compositionChart) compositionChart.destroy();
                    
                    compositionChart = new Chart(ctx, {
                        type: 'horizontalBar',
                        data: {
                            labels: data.data.map(d => d.composition.split(',').slice(0, 3).join(',') + '...'),
                            datasets: [{
                                label: 'èƒœç‡ (%)',
                                data: data.data.map(d => d.win_rate),
                                backgroundColor: data.data.map(d => 
                                    d.win_rate >= 50 ? 'rgba(76, 175, 80, 0.7)' : 'rgba(226, 74, 74, 0.7)'
                                ),
                                borderColor: data.data.map(d => 
                                    d.win_rate >= 50 ? 'rgba(76, 175, 80, 1)' : 'rgba(226, 74, 74, 1)'
                                ),
                                borderWidth: 1
                            }]
                        },
                        options: {
                            indexAxis: 'y',
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    beginAtZero: true,
                                    max: 100,
                                    title: {
                                        display: true,
                                        text: 'èƒœç‡ (%)'
                                    }
                                }
                            },
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const data = context.dataset.data[context.dataIndex];
                                            const comp = data.context.composition;
                                            const freq = data.context.frequency;
                                            return `é˜µå®¹: ${comp}\nå‡ºåœº: ${freq}æ¬¡\nèƒœç‡: ${data}%`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                    
                    // ä¸ºå›¾è¡¨æ•°æ®æ·»åŠ ä¸Šä¸‹æ–‡
                    compositionChart.data.datasets[0].data = compositionChart.data.datasets[0].data.map((value, index) => ({
                        value: value,
                        context: data.data[index]
                    }));
                }
            } catch (error) {
                console.error('åŠ è½½é˜µå®¹åˆ†æå¤±è´¥:', error);
            }
        }
        
        // è‹±é›„è¯¦æƒ…å¼¹çª—
        function showChampionDetail(champion) {
            alert(`å³å°†æ˜¾ç¤º ${champion} çš„è¯¦ç»†åˆ†æ...\n\næ­¤åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼`);
        }
        
        // æœç´¢è‹±é›„
        document.getElementById('championSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const champion = this.value.trim();
                if (champion) {
                    loadChampionStats(champion);
                }
            }
        });
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadWinRateAnalysis();
            loadChampionStats();
            loadTeamComposition();
        });
    </script>
    
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(200, 170, 110, 0.1);
        }
        
        th {
            background-color: rgba(200, 170, 110, 0.1);
            font-weight: 600;
            color: var(--lol-gold);
        }
        
        tr:hover {
            background-color: rgba(200, 170, 110, 0.05);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
    </style>
</body>
</html>
