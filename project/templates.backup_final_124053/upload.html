<!DOCTYPE html>
<html>
<head>
    <title>æ–‡ä»¶ä¸Šä¼  - è‹±é›„è”ç›Ÿæ•°æ®åˆ†æ</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 600px; margin: 0 auto; }
        h1 { color: #333; }
        .upload-box { border: 2px dashed #ccc; padding: 40px; text-align: center; margin: 20px 0; }
        .btn { background: #007bff; color: white; padding: 10px 20px; border: none; cursor: pointer; }
        .btn:hover { background: #0056b3; }
        .back-link { display: block; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ æ–‡ä»¶ä¸Šä¼ </h1>
        <p>ä¸Šä¼ è‹±é›„è”ç›Ÿæ•°æ®æ–‡ä»¶è¿›è¡Œåˆ†æ</p>
        
        <form id="uploadForm" enctype="multipart/form-data">
            <div class="upload-box">
                <p>å°†CSVæ–‡ä»¶æ‹–æ”¾åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                <input type="file" id="fileInput" name="file" accept=".csv">
                <br><br>
                <button type="submit" class="btn">ä¸Šä¼ æ–‡ä»¶</button>
            </div>
        </form>
        
        <div id="result" style="margin-top: 20px;"></div>
        
        <a href="/" class="back-link">â† è¿”å›é¦–é¡µ</a>
    </div>
    
    <script>
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const fileInput = document.getElementById('fileInput');
            const resultDiv = document.getElementById('result');
            
            if (!fileInput.files[0]) {
                resultDiv.innerHTML = '<p style="color: red;">è¯·é€‰æ‹©æ–‡ä»¶</p>';
                return;
            }
            
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            
            resultDiv.innerHTML = '<p>æ­£åœ¨ä¸Šä¼ ...</p>';
            
            fetch('/api/match/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div style="background: #d4edda; padding: 15px; border-radius: 5px;">
                            <h3>âœ… ä¸Šä¼ æˆåŠŸï¼</h3>
                            <p>æ–‡ä»¶: ${data.stats.filename}</p>
                            <p>æ€»è®°å½•æ•°: ${data.stats.total_records}</p>
                            <p>æˆåŠŸå¯¼å…¥: ${data.stats.imported}</p>
                            <p>è·³è¿‡: ${data.stats.skipped}</p>
                            <p>å¹³å‡æ—¶é•¿: ${data.stats.avg_duration} åˆ†é’Ÿ</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<p style="color: red;">âŒ ä¸Šä¼ å¤±è´¥: ${data.error}</p>`;
                }
            })
            .catch(error => {
                resultDiv.innerHTML = `<p style="color: red;">âŒ ä¸Šä¼ é”™è¯¯: ${error}</p>`;
            });
        });
    </script>
</body>
</html>
